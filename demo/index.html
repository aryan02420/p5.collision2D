<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>p5.collision2D</title>
</head>

<body>
  <div id="canvas-element"></div>
  <p>scroll to change object</p>
  <div>

    <pre style="color:#000000;background:#ffffff;"><span style="color:#800000; font-weight:bold; ">let</span> sketch <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">function</span><span style="color:#808030; ">(</span>p<span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
  <span style="color:#800000; font-weight:bold; ">let</span> c2d <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">new</span> Collision2D<span style="color:#808030; ">(</span>p<span style="color:#808030; ">)</span>
  <span style="color:#800000; font-weight:bold; ">let</span> point1<span style="color:#808030; ">,</span> point11<span style="color:#808030; ">,</span> line1<span style="color:#808030; ">,</span> line11<span style="color:#808030; ">,</span> box1<span style="color:#808030; ">,</span> circle1
  <span style="color:#800000; font-weight:bold; ">let</span> point2<span style="color:#808030; ">,</span> line2<span style="color:#808030; ">,</span> box2<span style="color:#808030; ">,</span> circle2
  <span style="color:#800000; font-weight:bold; ">let</span> <span style="color:#800000; font-weight:bold; ">fixed</span><span style="color:#808030; ">,</span> follower<span style="color:#800080; ">;</span>
  <span style="color:#800000; font-weight:bold; ">let</span> shape <span style="color:#808030; ">=</span> <span style="color:#008c00; ">0</span><span style="color:#800080; ">;</span>

  p<span style="color:#808030; ">.</span>mouseWheel <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">function</span><span style="color:#808030; ">(</span>event<span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
    shape <span style="color:#808030; ">+=</span> <span style="color:#008c00; ">1</span>
    shape <span style="color:#808030; ">%=</span> <span style="color:#008c00; ">4</span>
    c2d<span style="color:#808030; ">.</span>clearLayer<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">follower</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span>
    c2d<span style="color:#808030; ">.</span>addObjToLayer<span style="color:#808030; ">(</span>follower<span style="color:#808030; ">[</span>shape<span style="color:#808030; ">]</span><span style="color:#808030; ">,</span> <span style="color:#800000; ">'</span><span style="color:#0000e6; ">follower</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span>

  <span style="color:#800080; ">}</span>

  p<span style="color:#808030; ">.</span>setup <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">function</span><span style="color:#808030; ">(</span><span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
    p<span style="color:#808030; ">.</span>createCanvas<span style="color:#808030; ">(</span><span style="color:#008c00; ">200</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">200</span><span style="color:#808030; ">)</span>
    point1 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">POINT</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">40</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">40</span><span style="color:#808030; ">)</span>
    point11 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">POINT</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">50</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">)</span>
    line1 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">LINE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">160</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">40</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">150</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">30</span><span style="color:#808030; ">)</span>
    line11 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">LINE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">120</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">50</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">140</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">10</span><span style="color:#808030; ">)</span>
    box1 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">BOX</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">160</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">160</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">30</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">40</span><span style="color:#808030; ">)</span>
    circle1 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">CIRCLE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">40</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">160</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">)</span>

    point2 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">POINT</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">100</span><span style="color:#808030; ">)</span>
    line2 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">LINE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">101</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">101</span><span style="color:#808030; ">)</span>
    box2 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">BOX</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">25</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">15</span><span style="color:#808030; ">)</span>
    circle2 <span style="color:#808030; ">=</span> c2d<span style="color:#808030; ">.</span>createCollisionPrimitive<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">CIRCLE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">100</span><span style="color:#808030; ">,</span><span style="color:#008c00; ">10</span><span style="color:#808030; ">)</span>

    <span style="color:#800000; font-weight:bold; ">fixed</span> <span style="color:#808030; ">=</span> <span style="color:#808030; ">[</span>point1<span style="color:#808030; ">,</span> point11<span style="color:#808030; ">,</span> line1<span style="color:#808030; ">,</span> line11<span style="color:#808030; ">,</span> box1<span style="color:#808030; ">,</span> circle1<span style="color:#808030; ">]</span>
    follower <span style="color:#808030; ">=</span> <span style="color:#808030; ">[</span>point2<span style="color:#808030; ">,</span> line2<span style="color:#808030; ">,</span> box2<span style="color:#808030; ">,</span> circle2<span style="color:#808030; ">]</span>

    c2d<span style="color:#808030; ">.</span>addObjToLayer<span style="color:#808030; ">(</span><span style="color:#800000; font-weight:bold; ">fixed</span><span style="color:#808030; ">,</span> <span style="color:#800000; ">'</span><span style="color:#0000e6; ">fixed</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span>
    c2d<span style="color:#808030; ">.</span>setLayerStyle<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">follower</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#800080; ">{</span>fill<span style="color:#800080; ">:</span> <span style="color:#008c00; ">100</span><span style="color:#800080; ">}</span><span style="color:#808030; ">)</span>
    c2d<span style="color:#808030; ">.</span>setLayerStyle<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">fixed</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#800080; ">{</span>strokeweight<span style="color:#800080; ">:</span> <span style="color:#008c00; ">2</span><span style="color:#800080; ">}</span><span style="color:#808030; ">)</span>

  <span style="color:#800080; ">}</span>

  p<span style="color:#808030; ">.</span>draw <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">function</span><span style="color:#808030; ">(</span><span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
    p<span style="color:#808030; ">.</span>background<span style="color:#808030; ">(</span><span style="color:#008c00; ">200</span><span style="color:#808030; ">)</span>
    <span style="color:#800000; font-weight:bold; ">let</span> f <span style="color:#808030; ">=</span> follower<span style="color:#808030; ">[</span>shape<span style="color:#808030; ">]</span>
    <span style="color:#800000; font-weight:bold; ">if</span> <span style="color:#808030; ">(</span>f<span style="color:#808030; ">.</span>type <span style="color:#808030; ">===</span> <span style="color:#800000; ">'</span><span style="color:#0000e6; ">LINE</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
      f<span style="color:#808030; ">.</span>end <span style="color:#808030; ">=</span> <span style="color:#808030; ">[</span>p<span style="color:#808030; ">.</span>mouseX<span style="color:#808030; ">-</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">,</span> p<span style="color:#808030; ">.</span>mouseY<span style="color:#808030; ">-</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">]</span>
    <span style="color:#800080; ">}</span> <span style="color:#800000; font-weight:bold; ">else</span> <span style="color:#800080; ">{</span>
      f<span style="color:#808030; ">.</span>center <span style="color:#808030; ">=</span> <span style="color:#808030; ">[</span>p<span style="color:#808030; ">.</span>mouseX<span style="color:#808030; ">-</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">,</span> p<span style="color:#808030; ">.</span>mouseY<span style="color:#808030; ">-</span><span style="color:#008c00; ">20</span><span style="color:#808030; ">]</span>
    <span style="color:#800080; ">}</span>
    <span style="color:#800000; font-weight:bold; ">if</span> <span style="color:#808030; ">(</span> c2d<span style="color:#808030; ">.</span>getColliding<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">follower</span><span style="color:#800000; ">'</span><span style="color:#808030; ">,</span> <span style="color:#800000; ">'</span><span style="color:#0000e6; ">fixed</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span><span style="color:#808030; ">.</span><span style="color:#800000; font-weight:bold; ">length</span> <span style="color:#808030; ">&gt;</span> <span style="color:#008c00; ">0</span><span style="color:#808030; ">)</span> <span style="color:#800080; ">{</span>
      p<span style="color:#808030; ">.</span>background<span style="color:#808030; ">(</span><span style="color:#008c00; ">200</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">80</span><span style="color:#808030; ">,</span> <span style="color:#008c00; ">100</span><span style="color:#808030; ">)</span>
    <span style="color:#800080; ">}</span>
    c2d<span style="color:#808030; ">.</span>drawCollisionOverlays<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">fixed</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span>
    c2d<span style="color:#808030; ">.</span>drawCollisionOverlays<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">follower</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span>
  <span style="color:#800080; ">}</span>
<span style="color:#800080; ">}</span>

<span style="color:#800000; font-weight:bold; ">let</span> myp5 <span style="color:#808030; ">=</span> <span style="color:#800000; font-weight:bold; ">new</span> p5<span style="color:#808030; ">(</span>sketch<span style="color:#808030; ">,</span> document<span style="color:#808030; ">.</span>getElementById<span style="color:#808030; ">(</span><span style="color:#800000; ">'</span><span style="color:#0000e6; ">canvas-element</span><span style="color:#800000; ">'</span><span style="color:#808030; ">)</span><span style="color:#808030; ">)</span>
</pre>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.3.0/p5.min.js"></script>
  <script src="p5.collision2D.js"></script>
  <script>
    let sketch = function (p) {
      let c2d = new Collision2D(p)
      let point1, point11, line1, line11, box1, circle1
      let point2, line2, box2, circle2
      let fixed, follower;
      let shape = 0;

      p.mouseWheel = function (event) {
        if ((c2d._collidingPointBox({x: p.mouseX, y: p.mouseY}, {_xmin: 0, _ymin: 0, _xmax: 200, _ymax: 200}))) {
          shape += 1
          shape %= 4
          c2d.clearLayer('follower')
          c2d.addObjToLayer(follower[shape], 'follower')
          return false
        }
      }

      p.setup = function () {
        p.createCanvas(200, 200)
        point1 = c2d.createCollisionPrimitive('POINT', 40, 40)
        point11 = c2d.createCollisionPrimitive('POINT', 50, 20)
        line1 = c2d.createCollisionPrimitive('LINE', 160, 40, 150, 30)
        line11 = c2d.createCollisionPrimitive('LINE', 120, 50, 140, 10)
        box1 = c2d.createCollisionPrimitive('BOX', 160, 160, 30, 40)
        circle1 = c2d.createCollisionPrimitive('CIRCLE', 40, 160, 20)

        point2 = c2d.createCollisionPrimitive('POINT', 100, 100)
        line2 = c2d.createCollisionPrimitive('LINE', 100, 100, 101, 101)
        box2 = c2d.createCollisionPrimitive('BOX', 100, 100, 25, 15)
        circle2 = c2d.createCollisionPrimitive('CIRCLE', 100, 100, 10)

        fixed = [point1, point11, line1, line11, box1, circle1]
        follower = [point2, line2, box2, circle2]

        c2d.addObjToLayer(fixed, 'fixed')
        c2d.setLayerStyle('follower', {
          fill: 100
        })
        c2d.setLayerStyle('fixed', {
          strokeweight: 2
        })

      }

      p.draw = function () {
        p.background(200)
        let f = follower[shape]
        if (f.type === 'LINE') {
          f.end = [p.mouseX - 20, p.mouseY - 20]
        } else {
          f.center = [p.mouseX - 20, p.mouseY - 20]
        }
        if (c2d.getColliding('follower', 'fixed').length > 0) {
          p.background(200, 80, 100)
        }
        c2d.drawCollisionOverlays('fixed')
        c2d.drawCollisionOverlays('follower')
      }
    }

    let myp5 = new p5(sketch, document.getElementById('canvas-element'))
  </script>
</body>

</html>